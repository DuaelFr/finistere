<?php

function cdt_formatters_field_formatter_info() {
  $formatters = array(
    'bpimages' => array(
      'label' => t('Active thumdails multi image field'),
      'field types' => array('filefield'),
      'description' => t('Create an image with active thumdails below'),
      'multiple values' => CONTENT_HANDLE_MODULE,
    ),
  );
  return $formatters;
}

function cdt_formatters_theme() {
  $theme = array(
    'cdt_formatters_formatter_bpimages' => array('arguments' => array('element' => NULL),),
  );
  return $theme;
}

function theme_cdt_formatters_formatter_bpimages($element) {
	$output = '';
  	
  	$img='';
  	$thumdails = '';
  	
	$tiny_imgs = array();
	
	if(count($element)>0 && isset($element[0]['#item']['fid'])){
		
		for($i=0; $i<count($element) && $i<4; $i++){
			if(isset($element[$i]['#item']['fid'])){
				$item = $element[$i]['#item'];
				$img.='<a class="lien_img">'.theme('imagecache', 'bp_detail_big', $item['filepath'], $item['data']['alt'], $item['data']['title']).'</a>';
				$tiny_imgs[] = '<a href="#" '.($i==0 ? 'class="current"' : '').'>'.theme('imagecache', 'bp_tiny_img', $item['filepath'], $item['data']['alt'], $item['data']['title']).'</a>';
			}
		}
		
		$output.=$img;
		if(isset($element[1])){
			$output .= '<ul class="g-tabs">';
			for($i=0; $i<count($tiny_imgs) && $i<4; $i++){
				$item = $tiny_imgs[$i];
				$class='';
				if($i==0)
					$class = 'first';
				elseif($i+1>=count($tiny_imgs))
					$class = 'last';
				$output.= '<li class="'.$class.'">'.$item.'</li>';
			}
			$output .= '</ul>';
		}
		
	}
  
  return $output;
}